<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Kotlin Coroutines: Structured Concurrency - Xizhi Zhu</title><meta name=description content="In the previous article, we discussed the basics on how to Kotlin Coroutines. Now, let&rsquo;s continue to the topic of structured concurrency."><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Xizhi Zhu","url":"https:\/\/xizzhu.me\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/xizzhu.me\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/xizzhu.me\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/xizzhu.me\/post\/2019-05-24-kotlin-coroutine-structured-concurrency\/","name":"Kotlin coroutines structured concurrency"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":""},"headline":"Kotlin Coroutines: Structured Concurrency","description":"In the previous article, we discussed the basics on how to Kotlin Coroutines. Now, let\u0026rsquo;s continue to the topic of structured concurrency.\n","inLanguage":"en","wordCount":917,"datePublished":"2019-05-24T00:00:00","dateModified":"2019-05-24T00:00:00","image":"https:\/\/xizzhu.me\/images\/logo.png","keywords":["kotlin, coroutine"],"mainEntityOfPage":"https:\/\/xizzhu.me\/post\/2019-05-24-kotlin-coroutine-structured-concurrency\/","publisher":{"@type":"Organization","name":"https:\/\/xizzhu.me\/","logo":{"@type":"ImageObject","url":"https:\/\/xizzhu.me\/images\/logo.png","height":60,"width":60}}}</script><meta property="og:title" content="Kotlin Coroutines: Structured Concurrency"><meta property="og:description" content="In the previous article, we discussed the basics on how to Kotlin Coroutines. Now, let&rsquo;s continue to the topic of structured concurrency."><meta property="og:image" content="https://xizzhu.me/images/logo.png"><meta property="og:url" content="https://xizzhu.me/post/2019-05-24-kotlin-coroutine-structured-concurrency/"><meta property="og:type" content="website"><meta property="og:site_name" content="Xizhi Zhu"><meta name=twitter:title content="Kotlin Coroutines: Structured Concurrency"><meta name=twitter:description content="In the previous article, we discussed the basics on how to Kotlin Coroutines. Now, let&rsquo;s continue to the topic of structured concurrency."><meta name=twitter:image content="https://xizzhu.me/images/logo.png"><meta name=twitter:card content="summary"><link href=https://xizzhu.me/images/logo.png rel=icon type=image/x-icon><meta name=generator content="Hugo 0.73.0"><link rel=alternate href=https://xizzhu.me/index.xml type=application/rss+xml title="Xizhi Zhu"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://xizzhu.me/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://xizzhu.me/css/syntax.css><link rel=stylesheet href=https://xizzhu.me/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-128400000-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class=navbar-brand href=https://xizzhu.me/>Xizhi Zhu</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Posts href=/post>Posts</a></li><li><a title=Bible href=/bible>Bible</a></li><li><a title=随笔 href=/%e9%9a%8f%e7%ac%94>随笔</a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title="Xizhi Zhu" href=https://xizzhu.me/><img class=avatar-img src=https://xizzhu.me/images/logo.png alt="Xizhi Zhu"></a></div></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Kotlin Coroutines: Structured Concurrency</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on May 24, 2019
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>In the previous <a href=/post/2019-05-23-kotlin-coroutine>article</a>, we discussed the basics on how to Kotlin Coroutines. Now, let&rsquo;s continue to the topic of <strong>structured concurrency</strong>.</p><p>Let&rsquo;s still use the same example as in the previous article:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>suspend</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>readFromDisk</span>(key: String): String = withContext(Dispatchers.IO) { ... }

<span style=color:#66d9ef>val</span> deferred1 = GlobalScope.async() { readFromDisk(key1) }
<span style=color:#66d9ef>val</span> deferred2 = GlobalScope.async() { readFromDisk(key2) }

GlobalScope.launch {
  <span style=color:#66d9ef>val</span> value1 = deferred1.await()
  <span style=color:#66d9ef>val</span> value2 = deferred2.await()
}</code></pre></div></p><p>How are we handling the case when e.g. exception is thrown from <code>deferred1.await()</code>? More specifically, how can we easily cancel <code>deferred2</code> here?</p><p>To better understand this, we need to first discuss <strong>contexts</strong> and <strong>scopes</strong> of coroutines.</p><h2 id=contexts-and-scopes>Contexts and Scopes</h2><p>As briefly mentioned in the previous article, coroutines are always launched and executed in a <em>context</em> of some <em>scope</em>.</p><p>For example, <code>GlobalScope.launch()</code> in the example above means that the coroutine is launched in a &ldquo;global scope&rdquo;, meaning its lifetime is only limited by the lifetime of the whole application.</p><p>This is probably fine in many cases, but what if we need to limit the lifetime of a coroutine to a certain object? For example, in Android, we want to cancel all coroutines when an <code>Activity</code> is destroyed to avoid memory and resource leaks.</p><p>The Kotlin way is really easy:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyActivity</span>: Activity, CoroutineScope <span style=color:#66d9ef>by</span> CoroutineScope(Dispatchers.Main) {
  <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onCreate</span>() {
    <span style=color:#66d9ef>super</span>.onCreate()
    launch {
      <span style=color:#66d9ef>while</span> (isActive) {
        System.<span style=color:#66d9ef>out</span>.println(<span style=color:#e6db74>&#34;--&gt; still active...&#34;</span>)
        delay(<span style=color:#ae81ff>100</span>)
      }
    }
  }

  <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onDestroy</span>() {
    cancel()
    <span style=color:#66d9ef>super</span>.onDestroy()
  }
}</code></pre></div></p><p>Here, the <code>MyActivity</code> class implements the <code>CoroutineScope</code> interface, using <code>Dispatchers.Main</code> as the default dispatcher. This defines the <code>MyActivity</code> class as a <strong>scope</strong> for new coroutines.</p><p>The coroutine launched in the <code>onCreate()</code> function executes within this <code>MyActivity</code> scope on the main thread, i.e. its job becomes child of the parent scope&rsquo;s job.</p><p>The parent is responsible of tracking all the children launched. Therefore, when <code>cancel()</code> is called in <code>onDestroy()</code>, it automatically cancels all the unfinished child jobs. Also, if you call <code>join()</code> on the parent, it will wait until all child jobs finish.</p><p>Note that if we use <code>GlobalScope.launch()</code> instead of <code>launch()</code> here, the launched coroutine will still execute in the global scope, instead of the scope defined by <code>MyActivity</code>.</p><h3 id=contexts>Contexts</h3><p>If we read the source code, we&rsquo;ll notice that the <code>CoroutineScope</code> is just an interface with one property:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>CoroutineScope</span> {
  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>val</span> coroutineContext: CoroutineContext
}</code></pre></div></p><p>The <code>CoroutineContext</code> is essentially a map, describing the context of the coroutine, e.g. job of the coroutine, the dispatcher used, etc. Notably, the context should contain a <code>Job</code> that will become parent of new coroutines created within this context.</p><p>When launching new coroutines, you can also pass in some additional contexts, taking precedence over those from its parent. The resulting context will be used as context for the new coroutine. For example:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>launch(Dispatchers.IO + CoroutineName(<span style=color:#e6db74>&#34;yourCoroutineName&#34;</span>)) { ... }</code></pre></div></p><p>Here, it launches a coroutine with an explicitly specified dispatcher and a name (useful for debugging purpose) at the same time, while inheriting other context values from its parent. The <code>+</code> operator is used to define multiple values for a coroutine context.</p><p>Note that we should <strong>not</strong> pass a <code>Job</code> in the context parameter, unless we really want to break the parent-child relation.</p><h2 id=error-handling>Error Handling</h2><p>Now, let&rsquo;s get back to the original example, and see how Kotlin handles exceptions with structured concurrency:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>suspend</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>readFromDisk</span>(key: String): String = withContext(Dispatchers.IO) { ... }

launch {
  <span style=color:#66d9ef>val</span> deferred1 = async() { readFromDisk(key1) }
  <span style=color:#66d9ef>val</span> deferred2 = async() { readFromDisk(key2) }

  <span style=color:#66d9ef>try</span> {
    <span style=color:#66d9ef>val</span> value1 = deferred1.await()
    <span style=color:#66d9ef>val</span> value2 = deferred2.await()
  } <span style=color:#66d9ef>catch</span> (e: Exception) {
    ...
  }
}</code></pre></div></p><p>When an exception is thrown from <code>deferred1.await()</code>, the <code>try/catch</code> block works as you expect. Also, <code>deferred1</code> will cancel its parent, which furthers cancels all its children, including <code>deferred2</code>.</p><p>However, this piece of code will crash.</p><p>That&rsquo;s because the parent scope is canceled and re-throws the exception, which is not caught anywhere. This behavior is unfortunately counterintuitive and often leads to unwanted results (see more discussions <a href=https://github.com/Kotlin/kotlinx.coroutines/issues/763>here</a>).</p><p>To solve this, we should use the <code>coroutineScope()</code> function to create a new scope to wrap the async operations:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>launch {
  <span style=color:#66d9ef>try</span> {
    coroutineScope {
      <span style=color:#66d9ef>val</span> deferred1 = async() { readFromDisk(key1) }
      <span style=color:#66d9ef>val</span> deferred2 = async() { readFromDisk(key2) }

      <span style=color:#66d9ef>val</span> value1 = deferred1.await()
      <span style=color:#66d9ef>val</span> value2 = deferred2.await()
    }
  } <span style=color:#66d9ef>catch</span> (e: Exception) {
    ...
  }
}</code></pre></div></p><p>With this, the exception thrown from <code>await()</code> will be re-thrown by <code>coroutineScope</code>, which will be caught by the <code>try/catch</code> block.</p><h2 id=cancellation-is-cooperative>Cancellation is Cooperative</h2><p>As mentioned above, with structured concurrency, cancelling child coroutines is very easy. However, coroutine cancellation is <strong>cooperative</strong>, meaning calling <code>job.cancel()</code> won&rsquo;t simply kill the coroutines. It gives developers an opportunity to clean-up and release the resources.</p><p>To check if a <code>Job</code> is canceled, you can periodically inspect the <code>isActive</code> flag:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>val</span> job = launch() {
  <span style=color:#66d9ef>while</span> (isActive) {
    ...
  }
}</code></pre></div></p><p>You can also periodically call a suspend function that checks for cancellation, e.g. <code>yield()</code>:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>val</span> job = launch() {
  <span style=color:#66d9ef>while</span> (<span style=color:#66d9ef>true</span>) {
    yield()
    ...
  }
}</code></pre></div></p><h3 id=closing-resources>Closing resources</h3><p>You can handle resources clean-up and closing in the usual way, e.g. using the <code>try/finally</code> block or the <code>use()</code> function:<div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>val</span> job = launch() {
  <span style=color:#66d9ef>var</span> allocatedResources = ...
  <span style=color:#66d9ef>try</span> {
    <span style=color:#66d9ef>while</span> (isActive) {
      ...
    }
  } <span style=color:#66d9ef>finally</span> {
    allocatedResources<span style=color:#f92672>?.</span>release()

    <span style=color:#75715e>// in rare cases when you need to call suspend functions in a cancelled coroutine,
</span><span style=color:#75715e></span>    <span style=color:#75715e>// you need to wrap them with withContext(NonCancellable) {}
</span><span style=color:#75715e></span>    withContext(NonCancellable) {
      ...
    }
  }
}</code></pre></div></p><p>This is pretty much all you need to know about structured concurrency, and in the next article we&rsquo;ll discuss how to communicate between coroutines.</p><div class=blog-tags><a href=https://xizzhu.me//tags/kotlin/>kotlin</a>&nbsp;
<a href=https://xizzhu.me//tags/coroutine/>coroutine</a>&nbsp;</div><hr><section id=social-share><div class="list-inline footer-links"><div class=share-box aria-hidden=true><ul class=share><li><a href="//twitter.com/share?url=https%3a%2f%2fxizzhu.me%2fpost%2f2019-05-24-kotlin-coroutine-structured-concurrency%2f&text=Kotlin%20Coroutines%3a%20Structured%20Concurrency&via=" target=_blank title="Share on Twitter"><i class="fab fa-twitter"></i></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fxizzhu.me%2fpost%2f2019-05-24-kotlin-coroutine-structured-concurrency%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook"></i></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fxizzhu.me%2fpost%2f2019-05-24-kotlin-coroutine-structured-concurrency%2f&title=Kotlin%20Coroutines%3a%20Structured%20Concurrency" target=_blank title="Share on Reddit"><i class="fab fa-reddit"></i></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fxizzhu.me%2fpost%2f2019-05-24-kotlin-coroutine-structured-concurrency%2f&title=Kotlin%20Coroutines%3a%20Structured%20Concurrency" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin"></i></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fxizzhu.me%2fpost%2f2019-05-24-kotlin-coroutine-structured-concurrency%2f&title=Kotlin%20Coroutines%3a%20Structured%20Concurrency" target=_blank title="Share on StumbleUpon"><i class="fab fa-stumbleupon"></i></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fxizzhu.me%2fpost%2f2019-05-24-kotlin-coroutine-structured-concurrency%2f&description=Kotlin%20Coroutines%3a%20Structured%20Concurrency" target=_blank title="Share on Pinterest"><i class="fab fa-pinterest"></i></a></li></ul></div></div></section><h4 class=see-also>See also</h4><ul><li><a href=/post/2020-06-06-kotlin-generics/>Understanding Generics in Kotlin</a></li><li><a href=/post/2020-05-02-design-patterns-kotlin-behavioral-patterns/>Design Patterns in Kotlin: Behavioral Patterns</a></li><li><a href=/post/2020-04-27-design-patterns-kotlin-structural-patterns/>Design Patterns in Kotlin: Structural Patterns</a></li><li><a href=/post/2020-04-25-design-patterns-kotlin-creational-patterns/>Design Patterns in Kotlin: Creational Patterns</a></li><li><a href=/post/2020-04-24-effective-kotlin-serialization/>Effective Kotlin: Serialization</a></li></ul></article><ul class="pager blog-pager"><li class=previous><a href=https://xizzhu.me/post/2019-05-23-kotlin-coroutine/ data-toggle=tooltip data-placement=top title="Kotlin Coroutines: The Basics">&larr; Previous Post</a></li><li class=next><a href=https://xizzhu.me/post/2019-12-09-kotlin-coroutine-flow/ data-toggle=tooltip data-placement=top title="Kotlin Coroutines: Flows">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=https://github.com/xizzhu title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://linkedin.com/in/xizhizhu title=LinkedIn><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://stackoverflow.com/users/1664863/xizzhu title=StackOverflow><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted">&nbsp;&bull;&nbsp;&copy;
2020
&nbsp;&bull;&nbsp;
<a href=https://xizzhu.me/>Xizhi Zhu</a></p><p class="credits theme-by text-muted">Powered by <a href=https://gohugo.io/>Hugo</a> and <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> heme, hosted by <a href=https://pages.github.com/>GitHub Pages</a>.</p></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=https://xizzhu.me/js/main.js></script><script>renderMathInElement(document.body);</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://xizzhu.me/js/load-photoswipe.js></script></body></html>